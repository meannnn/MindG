<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MindGraph ç®¡ç†åå° | Admin Panel</title>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <link rel="stylesheet" href="/static/fonts/inter.css?v={{ version }}">
    <link rel="stylesheet" href="/static/css/admin.css?v={{ version }}">
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div style="display:flex;align-items:center;gap:1rem;">
                <h1>ğŸ“ MindGraph <span class="lang-zh">ç®¡ç†åå°</span><span class="lang-en">Admin Panel</span><span class="lang-az">Ä°darÉ™ Paneli</span></h1>
                <button class="lang-toggle" onclick="toggleLanguage()" id="langToggle">
                    <span class="lang-en">ä¸­æ–‡</span>
                    <span class="lang-zh">AZ</span>
                    <span class="lang-az">EN</span>
                </button>
            </div>
            <div class="user-info">
                <span id="adminName">Admin</span>
                <button class="btn btn-secondary btn-sm" onclick="window.location.href='/editor'">
                    <span class="lang-zh">å›¾åº“</span>
                    <span class="lang-en">Gallery</span>
                    <span class="lang-az">Qalereya</span>
                </button>
                <button class="btn btn-secondary btn-sm" onclick="logout()">
                    <span class="lang-zh">ç™»å‡º</span>
                    <span class="lang-en">Logout</span>
                    <span class="lang-az">Ã‡Ä±xÄ±ÅŸ</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Alert -->
        <div id="alert" class="alert"></div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" data-tab="dashboard" onclick="switchTab('dashboard', this)"><span class="lang-zh">ä»ªè¡¨ç›˜</span><span class="lang-en">Dashboard</span><span class="lang-az">Ä°darÉ™ Paneli</span></button>
            <button class="tab" data-tab="tokens" onclick="switchTab('tokens', this)"><span class="lang-zh">Tokenç»Ÿè®¡</span><span class="lang-en">Tokens</span><span class="lang-az">Tokenlar</span></button>
            <button class="tab" data-tab="schools" onclick="switchTab('schools', this)"><span class="lang-zh">å­¦æ ¡ç®¡ç†</span><span class="lang-en">Schools</span><span class="lang-az">MÉ™ktÉ™blÉ™r</span></button>
            <button class="tab" data-tab="users" onclick="switchTab('users', this)"><span class="lang-zh">ç”¨æˆ·ç®¡ç†</span><span class="lang-en">Users</span><span class="lang-az">Ä°stifadÉ™Ã§ilÉ™r</span></button>
            <button class="tab" data-tab="apikeys" onclick="switchTab('apikeys', this)"><span class="lang-zh">APIå¯†é’¥</span><span class="lang-en">API Keys</span><span class="lang-az">API AÃ§arlarÄ±</span></button>
            <button class="tab" data-tab="announcement" onclick="switchTab('announcement', this)"><span class="lang-zh">æ›´æ–°å…¬å‘Š</span><span class="lang-en">Announcement</span><span class="lang-az">Elan</span></button>
            <button class="tab" data-tab="realtime" onclick="switchTab('realtime', this)"><span class="lang-zh">å®æ—¶ç›‘æ§</span><span class="lang-en">Realtime</span><span class="lang-az">Real Vaxt</span></button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard-tab" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card" data-metric="users" onclick="showTrendChart('users', this)">
                    <h3><span class="lang-zh">æ€»ç”¨æˆ·æ•°</span><span class="lang-en">Total Users</span><span class="lang-az">Ãœmumi Ä°stifadÉ™Ã§ilÉ™r</span></h3>
                    <div class="value" id="stat-users">-</div>
                </div>
                <div class="stat-card" data-metric="organizations" onclick="showTrendChart('organizations', this)">
                    <h3><span class="lang-zh">å­¦æ ¡æ•°é‡</span><span class="lang-en">Organizations</span><span class="lang-az">TÉ™ÅŸkilatlar</span></h3>
                    <div class="value" id="stat-orgs">-</div>
                </div>
                <div class="stat-card" data-metric="registrations" onclick="showTrendChart('registrations', this)">
                    <h3><span class="lang-zh">ä»Šæ—¥æ³¨å†Œ</span><span class="lang-en">Today</span><span class="lang-az">Bu GÃ¼n</span></h3>
                    <div class="value" id="stat-recent">-</div>
                </div>
                <div class="stat-card" data-metric="tokens" onclick="showTrendChart('tokens', this)">
                    <h3><span class="lang-zh">æ€»Tokenä½¿ç”¨</span><span class="lang-en">Total Tokens</span><span class="lang-az">Ãœmumi Tokenlar</span></h3>
                    <div class="value" id="stat-tokens">-</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">ğŸ† <span class="lang-zh">æ´»è·ƒå­¦æ ¡æ’è¡Œæ¦œ (æŒ‰æ€»Tokenä½¿ç”¨é‡)</span><span class="lang-en">Top Active Schools (by Total Tokens)</span><span class="lang-az">Æn Aktiv MÉ™ktÉ™blÉ™r (Ãœmumi TokenlÉ™rÉ™ GÃ¶rÉ™)</span></h2>
                </div>
                <div id="org-distribution"></div>
            </div>
        </div>

        <!-- Tokens Tracking Tab -->
        <div id="tokens-tab" class="tab-content">
            <div class="stats-grid">
                <div class="stat-card" data-metric="token-today" onclick="showTrendChart('token-today', this)">
                    <h3><span class="lang-zh">ä»Šæ—¥Token</span><span class="lang-en">Today</span><span class="lang-az">Bu GÃ¼n</span></h3>
                    <div class="value" id="token-today">-</div>
                </div>
                <div class="stat-card" data-metric="token-week" onclick="showTrendChart('token-week', this)">
                    <h3><span class="lang-zh">è¿‡å»ä¸€å‘¨</span><span class="lang-en">Past Week</span><span class="lang-az">KeÃ§É™n HÉ™ftÉ™</span></h3>
                    <div class="value" id="token-week">-</div>
                </div>
                <div class="stat-card" data-metric="token-month" onclick="showTrendChart('token-month', this)">
                    <h3><span class="lang-zh">è¿‡å»ä¸€æœˆ</span><span class="lang-en">Past Month</span><span class="lang-az">KeÃ§É™n Ay</span></h3>
                    <div class="value" id="token-month">-</div>
                </div>
                <div class="stat-card" data-metric="token-total" onclick="showTrendChart('token-total', this)">
                    <h3><span class="lang-zh">æ€»è®¡</span><span class="lang-en">Total</span><span class="lang-az">Ãœmumi</span></h3>
                    <div class="value" id="token-total">-</div>
                </div>
            </div>

            <div class="token-leaderboards-grid">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">ğŸ† <span class="lang-zh">æ€»Tokenä½¿ç”¨é‡</span><span class="lang-en">Total Token Usage</span><span class="lang-az">Ãœmumi Token Ä°stifadÉ™si</span></h2>
                    </div>
                    <div id="token-users-list"></div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">ğŸ† <span class="lang-zh">ä»Šæ—¥Tokenæ’è¡Œæ¦œ</span><span class="lang-en">Today's Token Leaderboard</span><span class="lang-az">Bu GÃ¼nÃ¼n Token Reytinqi</span></h2>
                    </div>
                    <div id="token-users-today-list"></div>
                </div>
            </div>
        </div>

        <!-- Schools Tab -->
        <div id="schools-tab" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title"><span class="lang-zh">å­¦æ ¡åˆ—è¡¨</span><span class="lang-en">School List</span><span class="lang-az">MÉ™ktÉ™b SiyahÄ±sÄ±</span></h2>
                    <div style="display:flex;gap:1rem;align-items:center;">
                        <select id="school-filter" name="school-filter" class="form-select" style="min-width:250px;" onchange="filterSchools()">
                            <option value=""></option>
                        </select>
                        <button class="btn btn-primary" onclick="showCreateSchoolModal()" style="white-space:nowrap;">
                            â• <span class="lang-zh">åˆ›å»ºå­¦æ ¡</span><span class="lang-en">Create School</span><span class="lang-az">MÉ™ktÉ™b Yarat</span>
                        </button>
                    </div>
                </div>
                
                <div id="schools-loading" class="spinner"></div>
                <table id="schools-table" style="display:none;">
                    <thead>
                        <tr>
                            <th><span class="lang-zh">å­¦æ ¡åç§°</span><span class="lang-en">Name</span><span class="lang-az">Ad</span></th>
                            <th><span class="lang-zh">é‚€è¯·ç </span><span class="lang-en">Invitation Code</span><span class="lang-az">DÉ™vÉ™t Kodu</span></th>
                            <th><span class="lang-zh">Tokenä½¿ç”¨é‡</span><span class="lang-en">Tokens Used</span><span class="lang-az">Ä°stifadÉ™ Olunan Tokenlar</span></th>
                            <th><span class="lang-zh">çŠ¶æ€</span><span class="lang-en">Status</span><span class="lang-az">Status</span></th>
                            <th><span class="lang-zh">ç”¨æˆ·æ•°</span><span class="lang-en">Users</span><span class="lang-az">Ä°stifadÉ™Ã§ilÉ™r</span></th>
                            <th><span class="lang-zh">æ“ä½œ</span><span class="lang-en">Actions</span><span class="lang-az">ÆmÉ™liyyatlar</span></th>
                        </tr>
                    </thead>
                    <tbody id="schools-tbody"></tbody>
                </table>
            </div>
        </div>

        <!-- Users Tab -->
        <div id="users-tab" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title"><span class="lang-zh">ç”¨æˆ·åˆ—è¡¨</span><span class="lang-en">User List</span><span class="lang-az">Ä°stifadÉ™Ã§i SiyahÄ±sÄ±</span></h2>
                </div>
                
                <!-- Filter Controls -->
                <div style="padding:1rem;background:#f8fafc;border-bottom:1px solid #e2e8f0;">
                    <div style="display:flex;gap:1rem;flex-wrap:wrap;align-items:end;">
                        <div style="flex:1;min-width:200px;">
                            <label class="form-label" style="margin-bottom:0.25rem;" for="user-search"><span class="lang-zh">æœç´¢</span><span class="lang-en">Search</span><span class="lang-az">Axtar</span></label>
                            <input type="text" id="user-search" name="user-search" class="form-input" 
                                   placeholder="Name or Phone" 
                                   autocomplete="off"
                                   onkeyup="if(event.key==='Enter') filterUsers()">
                        </div>
                        <div style="min-width:200px;">
                            <label class="form-label" style="margin-bottom:0.25rem;" for="user-org-filter"><span class="lang-zh">å­¦æ ¡ç­›é€‰</span><span class="lang-en">Filter by School</span><span class="lang-az">MÉ™ktÉ™bÉ™ GÃ¶rÉ™ Filtr</span></label>
                            <select id="user-org-filter" name="user-org-filter" class="form-select" onchange="filterUsers()">
                                <option value=""><span class="lang-zh">å…¨éƒ¨å­¦æ ¡</span><span class="lang-en">All Schools</span><span class="lang-az">BÃ¼tÃ¼n MÉ™ktÉ™blÉ™r</span></option>
                            </select>
                        </div>
                        <button class="btn btn-primary" onclick="filterUsers()">
                            ğŸ” <span class="lang-zh">æœç´¢</span><span class="lang-en">Search</span><span class="lang-az">Axtar</span>
                        </button>
                        <button class="btn btn-secondary" onclick="clearUserFilters()">
                            â†» <span class="lang-zh">é‡ç½®</span><span class="lang-en">Reset</span><span class="lang-az">SÄ±fÄ±rla</span>
                        </button>
                    </div>
                </div>

                <div id="users-loading" class="spinner"></div>
                <table id="users-table" style="display:none;">
                    <thead>
                        <tr>
                            <th><span class="lang-zh">æ‰‹æœºå·</span><span class="lang-en">Phone</span><span class="lang-az">Telefon</span></th>
                            <th><span class="lang-zh">å§“å</span><span class="lang-en">Name</span><span class="lang-az">Ad</span></th>
                            <th><span class="lang-zh">å­¦æ ¡</span><span class="lang-en">Organization</span><span class="lang-az">TÉ™ÅŸkilat</span></th>
                            <th><span class="lang-zh">Tokenä½¿ç”¨é‡</span><span class="lang-en">Tokens Used</span><span class="lang-az">Ä°stifadÉ™ Olunan Tokenlar</span></th>
                            <th><span class="lang-zh">æ³¨å†Œæ—¶é—´</span><span class="lang-en">Registration Time</span><span class="lang-az">Qeydiyyat VaxtÄ±</span></th>
                            <th><span class="lang-zh">æ“ä½œ</span><span class="lang-en">Actions</span><span class="lang-az">ÆmÉ™liyyatlar</span></th>
                        </tr>
                    </thead>
                    <tbody id="users-tbody"></tbody>
                </table>
                
                <!-- Pagination Controls -->
                <div id="users-pagination" style="display:none;padding:1rem;border-top:1px solid #e2e8f0;background:#f8fafc;">
                    <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem;">
                        <div id="users-page-info" style="color:#64748b;">
                            <!-- Page info will be inserted here -->
                        </div>
                        <div style="display:flex;gap:0.5rem;">
                            <button id="users-prev-btn" class="btn btn-secondary btn-sm" onclick="previousUsersPage()">
                                â† <span class="lang-zh">ä¸Šä¸€é¡µ</span><span class="lang-en">Previous</span><span class="lang-az">ÆvvÉ™lki</span>
                            </button>
                            <div id="users-page-numbers" style="display:flex;gap:0.25rem;">
                                <!-- Page numbers will be inserted here -->
                            </div>
                            <button id="users-next-btn" class="btn btn-secondary btn-sm" onclick="nextUsersPage()">
                                <span class="lang-zh">ä¸‹ä¸€é¡µ</span><span class="lang-en">Next</span><span class="lang-az">NÃ¶vbÉ™ti</span> â†’
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- API Keys Tab -->
        <div id="apikeys-tab" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">ğŸ”‘ <span class="lang-zh">APIå¯†é’¥ç®¡ç†</span><span class="lang-en">API Keys Management</span><span class="lang-az">API AÃ§arlarÄ± Ä°darÉ™etmÉ™si</span></h2>
                    <button class="btn btn-primary" onclick="showCreateAPIKeyModal()">
                        â• <span class="lang-zh">åˆ›å»ºå¯†é’¥</span><span class="lang-en">Create API Key</span><span class="lang-az">API AÃ§arÄ± Yarat</span>
                    </button>
                </div>
                <div id="apikeys-loading" class="spinner"></div>
                <table id="apikeys-table" style="display:none;">
                    <thead>
                        <tr>
                            <th><span class="lang-zh">åç§°</span><span class="lang-en">Name</span><span class="lang-az">Ad</span></th>
                            <th><span class="lang-zh">APIå¯†é’¥</span><span class="lang-en">API Key</span><span class="lang-az">API AÃ§arÄ±</span></th>
                            <th><span class="lang-zh">ä½¿ç”¨é‡</span><span class="lang-en">Usage</span><span class="lang-az">Ä°stifadÉ™</span></th>
                            <th><span class="lang-zh">çŠ¶æ€</span><span class="lang-en">Status</span><span class="lang-az">Status</span></th>
                            <th><span class="lang-zh">åˆ›å»ºæ—¶é—´</span><span class="lang-en">Created</span><span class="lang-az">YaradÄ±lÄ±b</span></th>
                            <th><span class="lang-zh">æœ€åä½¿ç”¨</span><span class="lang-en">Last Used</span><span class="lang-az">Son Ä°stifadÉ™</span></th>
                            <th><span class="lang-zh">æ“ä½œ</span><span class="lang-en">Actions</span><span class="lang-az">ÆmÉ™liyyatlar</span></th>
                        </tr>
                    </thead>
                    <tbody id="apikeys-tbody"></tbody>
                </table>
            </div>
        </div>

        <!-- Update Announcement Tab -->
        <div id="announcement-tab" class="tab-content">
            <div id="announcement-loading" class="spinner"></div>
            
            <div id="announcement-form" style="display:none;">
                <!-- Enable/Disable Toggle -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title" style="font-size:1.1rem;"><span class="lang-zh">å…¬å‘Šå¼€å…³</span><span class="lang-en">Announcement Toggle</span><span class="lang-az">Elan AÃ§Ä±b-BaÄŸlama</span></h3>
                    </div>
                    <div style="padding:1rem;">
                        <div class="form-group" style="display:flex;align-items:center;gap:1rem;">
                            <label class="toggle-switch">
                                <input type="checkbox" id="announcement-enabled" name="announcement-enabled">
                                <span class="toggle-slider"></span>
                            </label>
                            <span style="font-weight:500;"><span class="lang-zh">å¯ç”¨æ›´æ–°å…¬å‘Š</span><span class="lang-en">Enable Update Announcement</span><span class="lang-az">YenilÉ™mÉ™ ElanÄ±nÄ± AktivlÉ™ÅŸdir</span></span>
                        </div>
                        <div style="margin-top:0.5rem;color:#64748b;font-size:0.875rem;">
                            <span class="lang-zh">å¼€å¯åï¼Œç”¨æˆ·ç™»å½•æ—¶å°†çœ‹åˆ°å…¬å‘Šå¼¹çª—ï¼ˆæ¯ä¸ªç‰ˆæœ¬åªæ˜¾ç¤ºä¸€æ¬¡ï¼‰</span><span class="lang-en">When enabled, users will see announcement popup on login (once per version)</span><span class="lang-az">AktivlÉ™ÅŸdirildikdÉ™, istifadÉ™Ã§ilÉ™r giriÅŸ zamanÄ± elan pÉ™ncÉ™rÉ™si gÃ¶rÉ™cÉ™klÉ™r (hÉ™r versiya Ã¼Ã§Ã¼n bir dÉ™fÉ™)</span>
                        </div>
                    </div>
                </div>

                <!-- Version -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title" style="font-size:1.1rem;"><span class="lang-zh">ç‰ˆæœ¬å·</span><span class="lang-en">Version Number</span><span class="lang-az">Versiya NÃ¶mrÉ™si</span></h3>
                    </div>
                    <div style="padding:1rem;">
                        <div class="form-group">
                            <label class="form-label" for="announcement-version"><span class="lang-zh">ç‰ˆæœ¬å·</span><span class="lang-en">Version Number</span><span class="lang-az">Versiya NÃ¶mrÉ™si</span></label>
                            <input type="text" id="announcement-version" name="announcement-version" class="form-input" placeholder="ä¾‹å¦‚: 1.5.0 / Example: 1.5.0 / MÉ™sÉ™lÉ™n: 1.5.0" autocomplete="off">
                            <small style="color:#64748b;"><span class="lang-zh">æ¯ä¸ªç‰ˆæœ¬å·åªä¼šæ˜¾ç¤ºä¸€æ¬¡å…¬å‘Šã€‚æ›´æ”¹ç‰ˆæœ¬å·åï¼Œæ‰€æœ‰ç”¨æˆ·å°†å†æ¬¡çœ‹åˆ°å…¬å‘Šã€‚</span><span class="lang-en">Each version number will only show announcement once. After changing version number, all users will see the announcement again.</span><span class="lang-az">HÉ™r versiya nÃ¶mrÉ™si yalnÄ±z bir dÉ™fÉ™ elan gÃ¶stÉ™rÉ™cÉ™k. Versiya nÃ¶mrÉ™sini dÉ™yiÅŸdikdÉ™n sonra, bÃ¼tÃ¼n istifadÉ™Ã§ilÉ™r yenidÉ™n elanÄ± gÃ¶rÉ™cÉ™klÉ™r.</span></small>
                        </div>
                    </div>
                </div>

                <!-- Content -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title" style="font-size:1.1rem;"><span class="lang-zh">å…¬å‘Šå†…å®¹</span><span class="lang-en">Announcement Content</span><span class="lang-az">Elan MÉ™zmunu</span></h3>
                    </div>
                    <div style="padding:1rem;">
                        <div class="form-group">
                            <label class="form-label" for="announcement-title"><span class="lang-zh">æ ‡é¢˜</span><span class="lang-en">Title</span><span class="lang-az">BaÅŸlÄ±q</span></label>
                            <input type="text" id="announcement-title" name="announcement-title" class="form-input" placeholder="ä¾‹å¦‚: ç³»ç»Ÿæ›´æ–° / Example: System Update / MÉ™sÉ™lÉ™n: Sistem YenilÉ™mÉ™si" autocomplete="off">
                        </div>
                        <div class="form-group">
                            <label class="form-label"><span class="lang-zh">å…¬å‘Šæ­£æ–‡</span><span class="lang-en">Announcement Body</span><span class="lang-az">Elan MÉ™tni</span></label>
                            <!-- Rich Text Toolbar -->
                            <div class="rich-text-toolbar">
                                <select id="font-family-zh" class="toolbar-select" onchange="announcementEditor.execCommand('fontName', this.value)" title="å­—ä½“">
                                    <option value="">å­—ä½“</option>
                                    <option value="Microsoft YaHei">å¾®è½¯é›…é»‘</option>
                                    <option value="SimSun">å®‹ä½“</option>
                                    <option value="SimHei">é»‘ä½“</option>
                                    <option value="KaiTi">æ¥·ä½“</option>
                                    <option value="FangSong">ä»¿å®‹</option>
                                    <option value="Arial">Arial</option>
                                </select>
                                <select id="font-size-zh" class="toolbar-select" onchange="announcementEditor.execCommand('fontSize', this.value)" title="å­—å·">
                                    <option value="">å­—å·</option>
                                    <option value="1">12px</option>
                                    <option value="2">14px</option>
                                    <option value="3">16px</option>
                                    <option value="4">18px</option>
                                    <option value="5">24px</option>
                                    <option value="6">32px</option>
                                    <option value="7">48px</option>
                                </select>
                                <div class="toolbar-divider"></div>
                                <button type="button" class="toolbar-btn" onclick="announcementEditor.execCommand('bold')" title="ç²—ä½“"><b>B</b></button>
                                <button type="button" class="toolbar-btn" onclick="announcementEditor.execCommand('italic')" title="æ–œä½“"><i>I</i></button>
                                <button type="button" class="toolbar-btn" onclick="announcementEditor.execCommand('underline')" title="ä¸‹åˆ’çº¿"><u>U</u></button>
                                <div class="toolbar-divider"></div>
                                <button type="button" class="toolbar-btn" onclick="announcementEditor.execCommand('insertUnorderedList')" title="æ— åºåˆ—è¡¨">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="8" y1="6" x2="21" y2="6"></line>
                                        <line x1="8" y1="12" x2="21" y2="12"></line>
                                        <line x1="8" y1="18" x2="21" y2="18"></line>
                                        <circle cx="4" cy="6" r="1" fill="currentColor"></circle>
                                        <circle cx="4" cy="12" r="1" fill="currentColor"></circle>
                                        <circle cx="4" cy="18" r="1" fill="currentColor"></circle>
                                    </svg>
                                </button>
                                <button type="button" class="toolbar-btn" onclick="announcementEditor.execCommand('insertOrderedList')" title="æœ‰åºåˆ—è¡¨">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="10" y1="6" x2="21" y2="6"></line>
                                        <line x1="10" y1="12" x2="21" y2="12"></line>
                                        <line x1="10" y1="18" x2="21" y2="18"></line>
                                        <text x="4" y="8" fill="currentColor" font-size="8">1</text>
                                        <text x="4" y="14" fill="currentColor" font-size="8">2</text>
                                        <text x="4" y="20" fill="currentColor" font-size="8">3</text>
                                    </svg>
                                </button>
                                <div class="toolbar-divider"></div>
                                <input type="color" id="text-color-zh" class="toolbar-color" onchange="announcementEditor.execCommand('foreColor', this.value)" title="æ–‡å­—é¢œè‰²" value="#000000">
                                <div class="toolbar-divider"></div>
                                <button type="button" class="toolbar-btn" onclick="announcementEditor.insertImage()" title="æ’å…¥å›¾ç‰‡">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                        <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                        <polyline points="21 15 16 10 5 21"></polyline>
                                    </svg>
                                </button>
                                <div class="emoji-picker-wrapper">
                                    <button type="button" class="toolbar-btn" onclick="announcementEditor.toggleEmojiPicker()" title="æ’å…¥è¡¨æƒ…">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="12" cy="12" r="10"></circle>
                                            <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
                                            <line x1="9" y1="9" x2="9.01" y2="9"></line>
                                            <line x1="15" y1="9" x2="15.01" y2="9"></line>
                                        </svg>
                                    </button>
                                    <div id="emoji-picker" class="emoji-picker" style="display:none;">
                                        <div class="emoji-tabs">
                                            <button type="button" class="emoji-tab active" onclick="announcementEditor.switchEmojiTab('common')">å¸¸ç”¨</button>
                                            <button type="button" class="emoji-tab" onclick="announcementEditor.switchEmojiTab('faces')">è¡¨æƒ…</button>
                                            <button type="button" class="emoji-tab" onclick="announcementEditor.switchEmojiTab('gestures')">æ‰‹åŠ¿</button>
                                            <button type="button" class="emoji-tab" onclick="announcementEditor.switchEmojiTab('objects')">ç‰©å“</button>
                                            <button type="button" class="emoji-tab" onclick="announcementEditor.switchEmojiTab('symbols')">ç¬¦å·</button>
                                        </div>
                                        <div class="emoji-grid" id="emoji-grid-common">
                                            <span onclick="announcementEditor.insertEmoji('ğŸ‰')">ğŸ‰</span>
                                            <span onclick="announcementEditor.insertEmoji('âœ¨')">âœ¨</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸš€')">ğŸš€</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ’¡')">ğŸ’¡</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ”¥')">ğŸ”¥</span>
                                            <span onclick="announcementEditor.insertEmoji('â­')">â­</span>
                                            <span onclick="announcementEditor.insertEmoji('â¤ï¸')">â¤ï¸</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ‘')">ğŸ‘</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ“¢')">ğŸ“¢</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ“Œ')">ğŸ“Œ</span>
                                            <span onclick="announcementEditor.insertEmoji('âœ…')">âœ…</span>
                                            <span onclick="announcementEditor.insertEmoji('âš¡')">âš¡</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ¯')">ğŸ¯</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ’ª')">ğŸ’ª</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸŒŸ')">ğŸŒŸ</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ')">ğŸ</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ†•')">ğŸ†•</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ†™')">ğŸ†™</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ’¯')">ğŸ’¯</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ†')">ğŸ†</span>
                                        </div>
                                        <div class="emoji-grid" id="emoji-grid-faces" style="display:none;">
                                            <span onclick="announcementEditor.insertEmoji('ğŸ˜€')">ğŸ˜€</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ˜ƒ')">ğŸ˜ƒ</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ˜„')">ğŸ˜„</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ˜')">ğŸ˜</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ˜Š')">ğŸ˜Š</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ¥°')">ğŸ¥°</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ˜')">ğŸ˜</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ¤©')">ğŸ¤©</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ˜')">ğŸ˜</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ¤”')">ğŸ¤”</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ§')">ğŸ§</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ˜‡')">ğŸ˜‡</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ¤—')">ğŸ¤—</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ˜®')">ğŸ˜®</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ˜²')">ğŸ˜²</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ¥³')">ğŸ¥³</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ˜´')">ğŸ˜´</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ¤¯')">ğŸ¤¯</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ˜')">ğŸ˜</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ™„')">ğŸ™„</span>
                                        </div>
                                        <div class="emoji-grid" id="emoji-grid-gestures" style="display:none;">
                                            <span onclick="announcementEditor.insertEmoji('ğŸ‘')">ğŸ‘</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ‘')">ğŸ‘</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ‘')">ğŸ‘</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ™Œ')">ğŸ™Œ</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ¤')">ğŸ¤</span>
                                            <span onclick="announcementEditor.insertEmoji('âœ‹')">âœ‹</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ‘‹')">ğŸ‘‹</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ¤')">ğŸ¤</span>
                                            <span onclick="announcementEditor.insertEmoji('âœŒï¸')">âœŒï¸</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ¤Ÿ')">ğŸ¤Ÿ</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ‘Œ')">ğŸ‘Œ</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ‘†')">ğŸ‘†</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ‘‡')">ğŸ‘‡</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ‘ˆ')">ğŸ‘ˆ</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ‘‰')">ğŸ‘‰</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ’ª')">ğŸ’ª</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ™')">ğŸ™</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ¤™')">ğŸ¤™</span>
                                            <span onclick="announcementEditor.insertEmoji('âœï¸')">âœï¸</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ–ï¸')">ğŸ–ï¸</span>
                                        </div>
                                        <div class="emoji-grid" id="emoji-grid-objects" style="display:none;">
                                            <span onclick="announcementEditor.insertEmoji('ğŸ“±')">ğŸ“±</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ’»')">ğŸ’»</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ–¥ï¸')">ğŸ–¥ï¸</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ“Š')">ğŸ“Š</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ“ˆ')">ğŸ“ˆ</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ“')">ğŸ“</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ“š')">ğŸ“š</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ“–')">ğŸ“–</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ”§')">ğŸ”§</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ”¨')">ğŸ”¨</span>
                                            <span onclick="announcementEditor.insertEmoji('âš™ï¸')">âš™ï¸</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ”‘')">ğŸ”‘</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ”’')">ğŸ”’</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ”“')">ğŸ”“</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ’¾')">ğŸ’¾</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ“')">ğŸ“</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ—‚ï¸')">ğŸ—‚ï¸</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ“‹')">ğŸ“‹</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸµ')">ğŸµ</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ¬')">ğŸ¬</span>
                                        </div>
                                        <div class="emoji-grid" id="emoji-grid-symbols" style="display:none;">
                                            <span onclick="announcementEditor.insertEmoji('âœ…')">âœ…</span>
                                            <span onclick="announcementEditor.insertEmoji('âŒ')">âŒ</span>
                                            <span onclick="announcementEditor.insertEmoji('â­•')">â­•</span>
                                            <span onclick="announcementEditor.insertEmoji('â—')">â—</span>
                                            <span onclick="announcementEditor.insertEmoji('â“')">â“</span>
                                            <span onclick="announcementEditor.insertEmoji('âš ï¸')">âš ï¸</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ”´')">ğŸ”´</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸŸ ')">ğŸŸ </span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸŸ¡')">ğŸŸ¡</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸŸ¢')">ğŸŸ¢</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ”µ')">ğŸ”µ</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸŸ£')">ğŸŸ£</span>
                                            <span onclick="announcementEditor.insertEmoji('â¬†ï¸')">â¬†ï¸</span>
                                            <span onclick="announcementEditor.insertEmoji('â¬‡ï¸')">â¬‡ï¸</span>
                                            <span onclick="announcementEditor.insertEmoji('â¡ï¸')">â¡ï¸</span>
                                            <span onclick="announcementEditor.insertEmoji('â¬…ï¸')">â¬…ï¸</span>
                                            <span onclick="announcementEditor.insertEmoji('â†©ï¸')">â†©ï¸</span>
                                            <span onclick="announcementEditor.insertEmoji('ğŸ”„')">ğŸ”„</span>
                                            <span onclick="announcementEditor.insertEmoji('â•')">â•</span>
                                            <span onclick="announcementEditor.insertEmoji('â–')">â–</span>
                                        </div>
                                    </div>
                                </div>
                                <!-- Hidden file input for image upload -->
                                <input type="file" id="announcement-image-input" accept="image/*" style="display:none;" onchange="announcementEditor.handleImageUpload(this)">
                            </div>
                            <!-- Editable Content Area -->
                            <div id="announcement-message" class="rich-text-editor" contenteditable="true" data-placeholder="è¯·è¾“å…¥å…¬å‘Šå†…å®¹... / Please enter announcement content... / ZÉ™hmÉ™t olmasa elan mÉ™zmununu daxil edin..."></div>
                        </div>
                    </div>
                </div>

                <!-- Save Actions -->
                <div style="display:flex;gap:1rem;margin-top:1rem;">
                    <button class="btn btn-secondary" onclick="previewAnnouncement()">ğŸ‘ <span class="lang-zh">é¢„è§ˆ</span><span class="lang-en">Preview</span><span class="lang-az">Ã–nizlÉ™mÉ™</span></button>
                    <button class="btn btn-primary" onclick="saveAnnouncementConfig()">ğŸ’¾ <span class="lang-zh">ä¿å­˜è®¾ç½®</span><span class="lang-en">Save Settings</span><span class="lang-az">ParametrlÉ™ri Saxla</span></button>
                </div>
            </div>
        </div>

        <!-- Realtime Monitoring Tab -->
        <div id="realtime-tab" class="tab-content">
            <div class="card">
                <div class="card-header" style="display:flex;justify-content:space-between;align-items:center;">
                    <h2 class="card-title"><span class="lang-zh">å®æ—¶ç”¨æˆ·æ´»åŠ¨ç›‘æ§</span><span class="lang-en">Real-time User Activity Monitor</span><span class="lang-az">Real Vaxt Ä°stifadÉ™Ã§i FÉ™aliyyÉ™ti Monitoru</span></h2>
                    <div style="display:flex;gap:0.5rem;align-items:center;">
                        <span id="realtime-status" style="display:inline-flex;align-items:center;gap:0.5rem;padding:0.5rem 1rem;background:rgba(100,116,139,0.2);border-radius:8px;font-size:0.875rem;">
                            <span style="width:8px;height:8px;border-radius:50%;background:#64748b;"></span>
                            <span class="lang-zh">æœªè¿æ¥</span><span class="lang-en">Disconnected</span><span class="lang-az">BaÄŸlÄ± Deyil</span>
                        </span>
                        <button class="btn btn-primary" onclick="toggleRealtimeStream()" id="realtime-toggle-btn">
                            <span class="lang-zh">å¼€å§‹ç›‘æ§</span><span class="lang-en">Start Monitoring</span><span class="lang-az">Monitoru BaÅŸlat</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="stats-grid" style="margin-top:1rem;">
                <div class="stat-card">
                    <h3><span class="lang-zh">åœ¨çº¿ç”¨æˆ·</span><span class="lang-en">Active Users</span><span class="lang-az">Aktiv Ä°stifadÉ™Ã§ilÉ™r</span></h3>
                    <div class="value" id="realtime-active-users">0</div>
                </div>
                <div class="stat-card">
                    <h3><span class="lang-zh">æ€»ä¼šè¯æ•°</span><span class="lang-en">Total Sessions</span><span class="lang-az">Ãœmumi Sessiyalar</span></h3>
                    <div class="value" id="realtime-total-sessions">0</div>
                </div>
                <div class="stat-card">
                    <h3><span class="lang-zh">å”¯ä¸€ç”¨æˆ·</span><span class="lang-en">Unique Users</span><span class="lang-az">Unikal Ä°stifadÉ™Ã§ilÉ™r</span></h3>
                    <div class="value" id="realtime-unique-users">0</div>
                </div>
                <div class="stat-card">
                    <h3><span class="lang-zh">æœ€è¿‘æ´»åŠ¨</span><span class="lang-en">Recent Activities</span><span class="lang-az">Son FÉ™aliyyÉ™tlÉ™r</span></h3>
                    <div class="value" id="realtime-recent-activities">0</div>
                </div>
            </div>

            <!-- Active Users List -->
            <div class="card" style="margin-top:1rem;">
                <div class="card-header">
                    <h2 class="card-title"><span class="lang-zh">å½“å‰åœ¨çº¿ç”¨æˆ·</span><span class="lang-en">Currently Active Users</span><span class="lang-az">Hal-hazÄ±rda Aktiv Ä°stifadÉ™Ã§ilÉ™r</span></h2>
                </div>
                <div id="realtime-users-loading" class="spinner"></div>
                <div id="realtime-users-container" style="display:none;">
                    <table style="width:100%;border-collapse:collapse;">
                        <thead>
                            <tr style="border-bottom:1px solid rgba(255,255,255,0.1);">
                                <th style="text-align:left;padding:0.75rem;color:#94a3b8;font-weight:600;"><span class="lang-zh">ç”¨æˆ·</span><span class="lang-en">User</span><span class="lang-az">Ä°stifadÉ™Ã§i</span></th>
                                <th style="text-align:left;padding:0.75rem;color:#94a3b8;font-weight:600;"><span class="lang-zh">å½“å‰æ´»åŠ¨</span><span class="lang-en">Current Activity</span><span class="lang-az">Cari FÉ™aliyyÉ™t</span></th>
                                <th style="text-align:left;padding:0.75rem;color:#94a3b8;font-weight:600;"><span class="lang-zh">æ´»åŠ¨æ¬¡æ•°</span><span class="lang-en">Activity Count</span><span class="lang-az">FÉ™aliyyÉ™t SayÄ±</span></th>
                                <th style="text-align:left;padding:0.75rem;color:#94a3b8;font-weight:600;"><span class="lang-zh">ä¼šè¯æ—¶é•¿</span><span class="lang-en">Session Duration</span><span class="lang-az">Sessiya MÃ¼ddÉ™ti</span></th>
                                <th style="text-align:left;padding:0.75rem;color:#94a3b8;font-weight:600;"><span class="lang-zh">æœ€åæ´»åŠ¨</span><span class="lang-en">Last Activity</span><span class="lang-az">Son FÉ™aliyyÉ™t</span></th>
                            </tr>
                        </thead>
                        <tbody id="realtime-users-tbody">
                            <tr>
                                <td colspan="5" style="text-align:center;padding:2rem;color:#64748b;">
                                    <span class="lang-zh">æš‚æ— åœ¨çº¿ç”¨æˆ·</span><span class="lang-en">No active users</span><span class="lang-az">Aktiv istifadÉ™Ã§i yoxdur</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Backup List Modal -->
    <div id="backup-list-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ğŸ“¦ .env Backup Files</h3>
                <span class="close" onclick="closeModal('backup-list-modal')">&times;</span>
            </div>
            <div id="backup-list-loading" class="spinner"></div>
            <div id="backup-list-content" style="display:none;">
                <table style="width:100%;">
                    <thead>
                        <tr>
                            <th>Backup File</th>
                            <th>Created</th>
                            <th>Size</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="backup-list-tbody"></tbody>
                </table>
                <p id="no-backups-message" style="display:none;color:#64748b;text-align:center;padding:2rem;">
                    No backup files found. Backups are created automatically when you save settings.
                </p>
            </div>
        </div>
    </div>

    <!-- Create School Modal -->
    <div id="create-school-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><span class="lang-zh">åˆ›å»ºå­¦æ ¡</span><span class="lang-en">Create School</span><span class="lang-az">MÉ™ktÉ™b Yarat</span></h3>
                <span class="close" onclick="closeModal('create-school-modal')">&times;</span>
            </div>
            <div class="form-group">
                <label class="form-label" for="new-school-name"><span class="lang-zh">å­¦æ ¡åç§°</span><span class="lang-en">School Name</span><span class="lang-az">MÉ™ktÉ™b AdÄ±</span> *</label>
                <input type="text" id="new-school-name" name="new-school-name" class="form-input" 
                       placeholder="Beijing High School åŒ—äº¬é«˜ä¸­ / BakÄ± Liseyi" 
                       autocomplete="organization"
                       oninput="autoGenerateSchoolCode()" required>
                <small style="color:#64748b;"><span class="lang-zh">å…ˆè¾“å…¥å­¦æ ¡åç§°ï¼Œä»£ç å°†è‡ªåŠ¨ç”Ÿæˆ</span><span class="lang-en">Enter the school name first, code will be generated automatically</span><span class="lang-az">ÆvvÉ™lcÉ™ mÉ™ktÉ™b adÄ±nÄ± daxil edin, kod avtomatik yaradÄ±lacaq</span></small>
            </div>
            <div class="form-group">
                <label class="form-label" for="new-school-code"><span class="lang-zh">å­¦æ ¡ä»£ç </span><span class="lang-en">School Code</span><span class="lang-az">MÉ™ktÉ™b Kodu</span> *</label>
                <div style="display:flex;gap:0.5rem;">
                    <input type="text" id="new-school-code" name="new-school-code" class="form-input" 
                           placeholder="AUTO-GENERATED / è‡ªåŠ¨ç”Ÿæˆ / AVTOMATIK YARADILIR" required
                           autocomplete="off"
                           style="flex:1;background:#f8fafc;">
                    <button type="button" class="btn btn-secondary" onclick="regenerateSchoolCode()" title="Regenerate Code / é‡æ–°ç”Ÿæˆ / YenidÉ™n Yarat">
                        ğŸ”„
                    </button>
                </div>
                <small style="color:#64748b;"><span class="lang-zh">ä»å­¦æ ¡åç§°è‡ªåŠ¨ç”Ÿæˆï¼ˆå¯ç¼–è¾‘ï¼Œç‚¹å‡» ğŸ”„ é‡æ–°ç”Ÿæˆï¼‰</span><span class="lang-en">Auto-generated from school name (editable, click ğŸ”„ to regenerate)</span><span class="lang-az">MÉ™ktÉ™b adÄ±ndan avtomatik yaradÄ±lÄ±r (redaktÉ™ oluna bilÉ™r, ğŸ”„ dÃ¼ymÉ™sinÉ™ kliklÉ™yin)</span></small>
            </div>
            <div style="padding:1rem;background:#f8fafc;border-radius:8px;margin-bottom:1rem;">
                <small style="color:#64748b;">
                    â„¹ï¸ <strong>Note:</strong> Invitation code will be automatically generated after creation
                </small>
            </div>
            <button class="btn btn-primary" onclick="createSchool()"><span class="lang-zh">åˆ›å»º</span><span class="lang-en">Create</span></button>
        </div>
    </div>

    <!-- Edit School Modal -->
    <div id="edit-school-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><span class="lang-zh">ç¼–è¾‘å­¦æ ¡</span><span class="lang-en">Edit School</span><span class="lang-az">MÉ™ktÉ™bi RedaktÉ™ Et</span></h3>
                <span class="close" onclick="closeModal('edit-school-modal')">&times;</span>
            </div>
            <input type="hidden" id="edit-school-id" name="edit-school-id">
            <div class="form-group">
                <label class="form-label" for="edit-school-code"><span class="lang-zh">å­¦æ ¡ä»£ç </span><span class="lang-en">School Code</span><span class="lang-az">MÉ™ktÉ™b Kodu</span></label>
                <input type="text" id="edit-school-code" name="edit-school-code" class="form-input" autocomplete="off">
            </div>
            <div class="form-group">
                <label class="form-label" for="edit-school-name"><span class="lang-zh">å­¦æ ¡åç§°</span><span class="lang-en">School Name</span><span class="lang-az">MÉ™ktÉ™b AdÄ±</span></label>
                <input type="text" id="edit-school-name" name="edit-school-name" class="form-input" autocomplete="organization">
            </div>
            <div class="form-group">
                <label class="form-label" for="edit-school-invite"><span class="lang-zh">é‚€è¯·ç </span><span class="lang-en">Invitation Code</span><span class="lang-az">DÉ™vÉ™t Kodu</span></label>
                <input type="text" id="edit-school-invite" name="edit-school-invite" class="form-input" autocomplete="off">
            </div>
            <div class="form-group">
                <label class="form-label" for="edit-school-expires"><span class="lang-zh">æœåŠ¡åˆ°æœŸæ—¥æœŸ</span><span class="lang-en">Service Expiration Date</span><span class="lang-az">XidmÉ™t BitmÉ™ Tarixi</span></label>
                <input type="date" id="edit-school-expires" name="edit-school-expires" class="form-input" autocomplete="off">
                <small style="color:#64748b;"><span class="lang-zh">ç•™ç©ºè¡¨ç¤ºæ°¸ä¹…æœ‰æ•ˆ</span><span class="lang-en">Leave empty for no expiration</span><span class="lang-az">BoÅŸ buraxÄ±lsa, mÃ¼ddÉ™tsizdir</span></small>
            </div>
            <div class="form-group">
                <label class="form-label" for="edit-school-active"><span class="lang-zh">è´¦æˆ·çŠ¶æ€</span><span class="lang-en">Account Status</span><span class="lang-az">Hesab Statusu</span></label>
                <select id="edit-school-active" name="edit-school-active" class="form-select">
                    <option value="true"><span class="lang-zh">æ¿€æ´»</span><span class="lang-en">Active</span><span class="lang-az">Aktiv</span></option>
                    <option value="false"><span class="lang-zh">é”å®š</span><span class="lang-en">Locked</span><span class="lang-az">KilidlÉ™nib</span></option>
                </select>
                <small style="color:#64748b;"><span class="lang-zh">é”å®šåè¯¥ç»„ç»‡çš„æ‰€æœ‰ç”¨æˆ·å°†æ— æ³•ç™»å½•</span><span class="lang-en">Locked organizations cannot login</span><span class="lang-az">KilidlÉ™nmiÅŸ tÉ™ÅŸkilatlar giriÅŸ edÉ™ bilmÉ™z</span></small>
            </div>
            <div style="display:flex; gap:0.5rem; align-items:center;">
                <button class="btn btn-secondary" onclick="regenerateInviteCode()"><span class="lang-zh">é‡æ–°ç”Ÿæˆ</span><span class="lang-en">Regenerate</span><span class="lang-az">YenidÉ™n Yarat</span></button>
                <button class="btn btn-primary" onclick="updateSchool()"><span class="lang-zh">ä¿å­˜</span><span class="lang-en">Save</span><span class="lang-az">Saxla</span></button>
            </div>
        </div>
    </div>

    <!-- Edit User Modal -->
    <div id="edit-user-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><span class="lang-zh">ç¼–è¾‘ç”¨æˆ·</span><span class="lang-en">Edit User</span><span class="lang-az">Ä°stifadÉ™Ã§ini RedaktÉ™ Et</span></h3>
                <span class="close" onclick="closeModal('edit-user-modal')">&times;</span>
            </div>
            <input type="hidden" id="edit-user-id" name="edit-user-id">
            <div class="form-group">
                <label class="form-label" for="edit-user-phone"><span class="lang-zh">æ‰‹æœºå·</span><span class="lang-en">Phone Number</span><span class="lang-az">Telefon NÃ¶mrÉ™si</span> *</label>
                <input type="tel" id="edit-user-phone" name="edit-user-phone" class="form-input" 
                       placeholder="13812345678" maxlength="11" autocomplete="tel" required>
                <small style="color:#64748b;">11-digit Chinese mobile number</small>
            </div>
            <div class="form-group">
                <label class="form-label" for="edit-user-name"><span class="lang-zh">å§“å</span><span class="lang-en">Name</span><span class="lang-az">Ad</span> *</label>
                <input type="text" id="edit-user-name" name="edit-user-name" class="form-input" 
                       placeholder="Zhang Wei" autocomplete="name" required>
                <small style="color:#64748b;">At least 2 characters, no numbers</small>
            </div>
            <div class="form-group">
                <label class="form-label" for="edit-user-org"><span class="lang-zh">å­¦æ ¡</span><span class="lang-en">School</span><span class="lang-az">MÉ™ktÉ™b</span> *</label>
                <select id="edit-user-org" name="edit-user-org" class="form-select" required>
                    <option value="">Loading...</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label" for="edit-user-reset-password"><span class="lang-zh">é‡ç½®å¯†ç </span><span class="lang-en">Reset Password</span><span class="lang-az">Parolu SÄ±fÄ±rla</span></label>
                <input type="text" id="edit-user-reset-password" name="edit-user-reset-password" class="form-input" 
                       placeholder="12345678" value="12345678" autocomplete="new-password">
                <small style="color:#64748b;"><span class="lang-zh">ç•™ç©ºæˆ–è¾“å…¥ '12345678' å°†é‡ç½®ä¸ºé»˜è®¤å¯†ç  '12345678'</span><span class="lang-en">Leave empty or enter '12345678' to use default password '12345678'</span><span class="lang-az">BoÅŸ buraxÄ±n vÉ™ ya '12345678' daxil edin, standart parol '12345678' istifadÉ™ olunacaq</span></small>
            </div>
            <div style="display:flex;gap:0.5rem;align-items:center;justify-content:center;">
                <button class="btn btn-primary" onclick="updateUser()"><span class="lang-zh">ä¿å­˜</span><span class="lang-en">Save</span><span class="lang-az">Saxla</span></button>
                <button class="btn btn-warning" onclick="resetPasswordFromModal()"><span class="lang-zh">é‡ç½®å¯†ç </span><span class="lang-en">Reset Password</span><span class="lang-az">Parolu SÄ±fÄ±rla</span></button>
            </div>
        </div>
    </div>

    <!-- Create API Key Modal -->
    <div id="create-apikey-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ğŸ”‘ <span class="lang-zh">åˆ›å»ºAPIå¯†é’¥</span><span class="lang-en">Create API Key</span><span class="lang-az">API AÃ§arÄ± Yarat</span></h3>
                <span class="close" onclick="closeModal('create-apikey-modal')">&times;</span>
            </div>
            <div class="form-group">
                <label class="form-label" for="new-apikey-name"><span class="lang-zh">åç§°</span><span class="lang-en">Name</span><span class="lang-az">Ad</span> *</label>
                <input type="text" id="new-apikey-name" name="new-apikey-name" class="form-input" 
                       placeholder="Dify Integration, Mobile App, etc. / Difyé›†æˆ, ç§»åŠ¨åº”ç”¨ç­‰ / Dify Ä°nteqrasiyasÄ±, Mobil TÉ™tbiq vÉ™ s." autocomplete="off" required>
            </div>
            <div class="form-group">
                <label class="form-label" for="new-apikey-description"><span class="lang-zh">æè¿°</span><span class="lang-en">Description</span><span class="lang-az">TÉ™svir</span></label>
                <textarea id="new-apikey-description" name="new-apikey-description" class="form-textarea" style="min-height:80px;"
                          placeholder="Purpose of this API key... / æ­¤APIå¯†é’¥çš„ç”¨é€”... / Bu API aÃ§arÄ±nÄ±n mÉ™qsÉ™di..." autocomplete="off"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label" for="new-apikey-quota"><span class="lang-zh">é…é¢é™åˆ¶ï¼ˆç•™ç©ºè¡¨ç¤ºæ— é™åˆ¶ï¼‰</span><span class="lang-en">Quota Limit (leave empty for unlimited)</span><span class="lang-az">Kvota Limiti (boÅŸ buraxÄ±lsa, limitsizdir)</span></label>
                <input type="number" id="new-apikey-quota" name="new-apikey-quota" class="form-input" 
                       placeholder="10000" autocomplete="off">
            </div>
            <div class="form-group">
                <label class="form-label" for="new-apikey-expires"><span class="lang-zh">æœ‰æ•ˆæœŸï¼ˆå¤©æ•°ï¼Œå¯é€‰ï¼‰</span><span class="lang-en">Expires in (days, optional)</span><span class="lang-az">MÃ¼ddÉ™ti (gÃ¼n, istÉ™yÉ™ baÄŸlÄ±dÄ±r)</span></label>
                <input type="number" id="new-apikey-expires" name="new-apikey-expires" class="form-input" 
                       placeholder="365" autocomplete="off">
            </div>
            <button class="btn btn-primary" onclick="createAPIKey()">ğŸ”‘ <span class="lang-zh">ç”ŸæˆAPIå¯†é’¥</span><span class="lang-en">Generate API Key</span><span class="lang-az">API AÃ§arÄ± Yarat</span></button>
        </div>
    </div>

    <!-- Show API Key Modal -->
    <div id="show-apikey-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">âœ… <span class="lang-zh">APIå¯†é’¥å·²åˆ›å»º</span><span class="lang-en">API Key Created</span><span class="lang-az">API AÃ§arÄ± YaradÄ±ldÄ±</span></h3>
                <span class="close" onclick="closeModal('show-apikey-modal')">&times;</span>
            </div>
            <div class="alert alert-warning show">
                âš ï¸ <strong><span class="lang-zh">é‡è¦ï¼š</span><span class="lang-en">Important:</span><span class="lang-az">Vacibdir:</span></strong> <span class="lang-zh">è¯·å®‰å…¨ä¿å­˜æ­¤å¯†é’¥ - å®ƒä¸ä¼šå†æ¬¡æ˜¾ç¤ºï¼</span><span class="lang-en">Save this key securely - it won't be shown again!</span><span class="lang-az">Bu aÃ§arÄ± tÉ™hlÃ¼kÉ™siz saxlayÄ±n - yenidÉ™n gÃ¶stÉ™rilmÉ™yÉ™cÉ™k!</span>
            </div>
            <div class="form-group">
                <label class="form-label" for="generated-apikey"><span class="lang-zh">APIå¯†é’¥</span><span class="lang-en">API Key</span><span class="lang-az">API AÃ§arÄ±</span></label>
                <input type="text" id="generated-apikey" name="generated-apikey" class="form-input" readonly 
                       autocomplete="off"
                       style="font-family:monospace;font-size:0.875rem;" onclick="this.select()">
            </div>
            <div class="form-group">
                <label class="form-label" for="apikey-usage-instructions"><span class="lang-zh">ä½¿ç”¨è¯´æ˜</span><span class="lang-en">Usage Instructions</span><span class="lang-az">Ä°stifadÉ™ TÉ™limatlarÄ±</span></label>
                <textarea id="apikey-usage-instructions" name="apikey-usage-instructions" readonly class="form-textarea" style="min-height:100px;" autocomplete="off">Add this header to your HTTP requests:
X-API-Key: [your-key-here]

Example (curl):
curl -X POST http://your-server/api/generate_graph \
  -H "X-API-Key: [your-key]" \
  -H "Content-Type: application/json" \
  -d '{"prompt":"test","diagram_type":"mind_map"}'</textarea>
            </div>
            <button class="btn btn-primary" onclick="copyAPIKey()">ğŸ“‹ <span class="lang-zh">å¤åˆ¶åˆ°å‰ªè´´æ¿</span><span class="lang-en">Copy to Clipboard</span><span class="lang-az">MÃ¼badilÉ™ BuferinÉ™ Kopyala</span></button>
        </div>
    </div>

    <!-- Edit API Key Modal -->
    <div id="edit-apikey-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">âœï¸ <span class="lang-zh">ç¼–è¾‘APIå¯†é’¥</span><span class="lang-en">Edit API Key</span><span class="lang-az">API AÃ§arÄ±nÄ± RedaktÉ™ Et</span></h3>
                <span class="close" onclick="closeModal('edit-apikey-modal')">&times;</span>
            </div>
            <input type="hidden" id="edit-apikey-id" name="edit-apikey-id">
            <div class="form-group">
                <label class="form-label" for="edit-apikey-name"><span class="lang-zh">åç§°</span><span class="lang-en">Name</span><span class="lang-az">Ad</span></label>
                <input type="text" id="edit-apikey-name" name="edit-apikey-name" class="form-input" autocomplete="off">
            </div>
            <div class="form-group">
                <label class="form-label" for="edit-apikey-description"><span class="lang-zh">æè¿°</span><span class="lang-en">Description</span><span class="lang-az">TÉ™svir</span></label>
                <textarea id="edit-apikey-description" name="edit-apikey-description" class="form-textarea" style="min-height:80px;" autocomplete="off"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label" for="edit-apikey-quota"><span class="lang-zh">é…é¢é™åˆ¶ï¼ˆç•™ç©ºè¡¨ç¤ºæ— é™åˆ¶ï¼‰</span><span class="lang-en">Quota Limit (empty for unlimited)</span><span class="lang-az">Kvota Limiti (boÅŸ buraxÄ±lsa, limitsizdir)</span></label>
                <input type="number" id="edit-apikey-quota" name="edit-apikey-quota" class="form-input" autocomplete="off">
            </div>
            <div class="form-group">
                <label class="form-label" for="edit-apikey-usage"><span class="lang-zh">ä½¿ç”¨æ¬¡æ•°ï¼ˆå¦‚éœ€è¦å¯é‡ç½®ä¸º0ï¼‰</span><span class="lang-en">Usage Count (reset to 0 if needed)</span><span class="lang-az">Ä°stifadÉ™ SayÄ± (lazÄ±m olsa, 0-a sÄ±fÄ±rlayÄ±n)</span></label>
                <input type="number" id="edit-apikey-usage" name="edit-apikey-usage" class="form-input" autocomplete="off">
            </div>
            <button class="btn btn-primary" onclick="updateAPIKey()">ğŸ’¾ <span class="lang-zh">ä¿å­˜æ›´æ”¹</span><span class="lang-en">Save Changes</span><span class="lang-az">DÉ™yiÅŸikliklÉ™ri Saxla</span></button>
        </div>
    </div>

    <!-- Share Invitation Info Modal -->
    <div id="share-invite-modal" class="modal">
        <div class="modal-content" style="max-width:400px;">
            <div class="modal-header">
                <h3 class="modal-title">ğŸ“¤ <span class="lang-zh">åˆ†äº«é‚€è¯·ä¿¡æ¯</span><span class="lang-en">Share Invitation Info</span><span class="lang-az">DÉ™vÉ™t MÉ™lumatÄ±nÄ± PaylaÅŸ</span></h3>
                <span class="close" onclick="closeModal('share-invite-modal')">&times;</span>
            </div>
            <div style="margin-bottom:1rem;color:#64748b;font-size:0.9rem;">
                <span class="lang-zh">å¤åˆ¶ä»¥ä¸‹ä¿¡æ¯åˆ†äº«ç»™ç”¨æˆ·ï¼š</span>
                <span class="lang-en">Copy the information below to share with users:</span>
            </div>
            <div class="form-group">
                <label class="form-label" for="share-invite-text" style="display:none;">Share Invitation Text</label>
                <textarea id="share-invite-text" name="share-invite-text" class="form-textarea" readonly
                          style="min-height:100px;font-size:1rem;line-height:1.6;background:#f8fafc;border:2px solid #667eea;font-family:inherit;"
                          autocomplete="off"
                          onclick="this.select()"></textarea>
            </div>
            <button class="btn btn-primary" onclick="selectAndCopyShareText(this)" style="width:100%;">
                ğŸ“‹ <span class="lang-zh">é€‰ä¸­å¹¶å¤åˆ¶</span><span class="lang-en">Select and Copy</span>
            </button>
            <small style="display:block;margin-top:1rem;color:#94a3b8;text-align:center;">
                <span class="lang-zh">ç‚¹å‡»æ–‡æœ¬æ¡†å³å¯é€‰ä¸­ï¼Œæˆ–ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®è‡ªåŠ¨å¤åˆ¶</span>
                <span class="lang-en">Click the text box to select, or click the button above to copy automatically</span>
            </small>
        </div>
    </div>

    <!-- Trend Chart Modal -->
    <div id="trend-chart-modal" class="modal">
        <div class="modal-content chart-modal">
            <div class="modal-header">
                <div style="display:flex;align-items:center;gap:1rem;">
                    <button id="back-to-org-btn" onclick="goBackToOrgUsers()" style="display:none;background:#667eea;color:white;border:none;padding:0.5rem 1rem;border-radius:6px;cursor:pointer;font-size:0.9rem;font-weight:500;transition:background 0.2s;" onmouseover="this.style.background='#5568d3'" onmouseout="this.style.background='#667eea'">
                        â† <span class="lang-zh">è¿”å›</span><span class="lang-en">Back</span><span class="lang-az">Geri</span>
                    </button>
                    <h3 class="modal-title" id="trend-chart-title" style="margin:0;">
                        <span class="lang-zh">è¶‹åŠ¿å›¾è¡¨</span><span class="lang-en">Trend Chart</span><span class="lang-az">Tendensiya Qrafiki</span>
                    </h3>
                </div>
                <span class="close" onclick="closeModal('trend-chart-modal')">&times;</span>
            </div>
            <!-- Tabs -->
            <div class="modal-tabs" style="display:flex;border-bottom:2px solid #e2e8f0;margin-bottom:1rem;">
                <button class="modal-tab active" id="org-chart-tab" onclick="switchOrgModalTab('chart')">
                    <span class="lang-zh">è¶‹åŠ¿</span><span class="lang-en">Trend</span><span class="lang-az">Tendensiya</span>
                </button>
                <button class="modal-tab" id="org-users-tab" onclick="switchOrgModalTab('users')">
                    <span class="lang-zh">ç”¨æˆ·</span><span class="lang-en">Users</span><span class="lang-az">Ä°stifadÉ™Ã§ilÉ™r</span>
                </button>
            </div>
            <!-- Chart Tab Content -->
            <div id="org-chart-content" class="org-modal-tab-content">
                <div class="chart-container">
                    <canvas id="trend-chart-canvas"></canvas>
                </div>
                <div id="org-token-stats-cards" style="display:none;padding:1rem;border-top:1px solid #e2e8f0;">
                    <div class="stats-grid org-token-stats-grid" style="gap:1rem;">
                        <div class="stat-card" id="org-stat-today" onclick="switchOrgChartPeriod('today')" style="cursor:pointer;">
                            <h3><span class="lang-zh">ä»Šæ—¥Token</span><span class="lang-en">Today</span><span class="lang-az">Bu GÃ¼n</span></h3>
                            <div class="value" id="org-token-today">-</div>
                        </div>
                        <div class="stat-card" id="org-stat-week" onclick="switchOrgChartPeriod('week')" style="cursor:pointer;">
                            <h3><span class="lang-zh">è¿‡å»ä¸€å‘¨</span><span class="lang-en">Past Week</span><span class="lang-az">KeÃ§É™n HÉ™ftÉ™</span></h3>
                            <div class="value" id="org-token-week">-</div>
                        </div>
                        <div class="stat-card" id="org-stat-month" onclick="switchOrgChartPeriod('month')" style="cursor:pointer;">
                            <h3><span class="lang-zh">è¿‡å»ä¸€æœˆ</span><span class="lang-en">Past Month</span><span class="lang-az">KeÃ§É™n Ay</span></h3>
                            <div class="value" id="org-token-month">-</div>
                        </div>
                        <div class="stat-card" id="org-stat-total" onclick="switchOrgChartPeriod('total')" style="cursor:pointer;">
                            <h3><span class="lang-zh">æ€»è®¡</span><span class="lang-en">Total</span><span class="lang-az">Ãœmumi</span></h3>
                            <div class="value" id="org-token-total">-</div>
                        </div>
                    </div>
                </div>
                <!-- User Token Stats Cards (shown when viewing user trends) -->
                <div id="user-token-stats-cards" style="display:none;padding:1rem;border-top:1px solid #e2e8f0;">
                    <div class="stats-grid org-token-stats-grid" style="gap:1rem;">
                        <div class="stat-card" id="user-stat-today" onclick="switchUserChartPeriod('today')" style="cursor:pointer;">
                            <h3><span class="lang-zh">ä»Šæ—¥Token</span><span class="lang-en">Today</span><span class="lang-az">Bu GÃ¼n</span></h3>
                            <div class="value" id="user-token-today">-</div>
                        </div>
                        <div class="stat-card" id="user-stat-week" onclick="switchUserChartPeriod('week')" style="cursor:pointer;">
                            <h3><span class="lang-zh">è¿‡å»ä¸€å‘¨</span><span class="lang-en">Past Week</span><span class="lang-az">KeÃ§É™n HÉ™ftÉ™</span></h3>
                            <div class="value" id="user-token-week">-</div>
                        </div>
                        <div class="stat-card" id="user-stat-month" onclick="switchUserChartPeriod('month')" style="cursor:pointer;">
                            <h3><span class="lang-zh">è¿‡å»ä¸€æœˆ</span><span class="lang-en">Past Month</span><span class="lang-az">KeÃ§É™n Ay</span></h3>
                            <div class="value" id="user-token-month">-</div>
                        </div>
                        <div class="stat-card" id="user-stat-total" onclick="switchUserChartPeriod('total')" style="cursor:pointer;">
                            <h3><span class="lang-zh">æ€»è®¡</span><span class="lang-en">Total</span><span class="lang-az">Ãœmumi</span></h3>
                            <div class="value" id="user-token-total">-</div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Users Tab Content -->
            <div id="org-users-content" class="org-modal-tab-content" style="display:none;">
                <div id="org-users-loading" class="spinner"></div>
                <div id="org-users-list" style="display:none;max-height:500px;overflow-y:auto;">
                    <!-- User list will be populated here -->
                </div>
                <div id="org-users-empty" style="display:none;text-align:center;padding:3rem;color:#64748b;">
                    <span class="lang-zh">è¯¥å­¦æ ¡æš‚æ— ç”¨æˆ·</span><span class="lang-en">No users found for this organization</span><span class="lang-az">Bu tÉ™ÅŸkilat Ã¼Ã§Ã¼n istifadÉ™Ã§i tapÄ±lmadÄ±</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Unauthenticated Overlay -->
    <div id="auth-required-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:9999; justify-content:center; align-items:center;">
        <div style="background:white; border-radius:20px; padding:3rem; text-align:center; max-width:500px; box-shadow:0 20px 60px rgba(0,0,0,0.5);">
            <div style="font-size:4rem; margin-bottom:1rem;">ğŸ”’</div>
            <h2 style="font-size:1.75rem; margin-bottom:1rem; color:#1e293b;">Admin Authentication Required</h2>
            <p style="color:#64748b; margin-bottom:2rem;">Please authenticate to access the admin panel</p>
            
            <div style="display:grid; gap:1rem;">
                <a href="/auth?redirect=/admin" class="btn btn-primary" style="display:block; text-decoration:none; padding:1rem;">
                    ğŸ” Standard Login / æ ‡å‡†ç™»å½•
                </a>
                <a href="/demo?redirect=/admin" class="btn btn-secondary" style="display:block; text-decoration:none; padding:1rem;">
                    ğŸ¯ Demo Mode / æ¼”ç¤ºæ¨¡å¼
                </a>
            </div>
            
            <p style="color:#94a3b8; font-size:0.875rem; margin-top:1.5rem;">
                Admins can access this panel from any authentication mode
            </p>
        </div>
    </div>

    <!-- Chart.js libraries -->
    <script src="/static/js/auth-helper.js?v={{ version }}"></script>
    <script src="/static/js/chart.umd.min.js?v={{ version }}"></script>
    <script src="/static/js/chartjs-plugin-zoom.min.js?v={{ version }}"></script>
    <script src="/static/js/chartjs-plugin-datalabels.min.js?v={{ version }}"></script>

    <!-- Register Chart.js plugins -->
    <script>
        // Register Chart.js plugins after they're loaded
        (function() {
            // Wait for Chart.js and plugins to be available
            function registerPlugins() {
                if (typeof Chart !== 'undefined') {
                    // Register datalabels plugin if available
                    if (typeof ChartDataLabels !== 'undefined') {
                        Chart.register(ChartDataLabels);
                        console.log('Chart.js datalabels plugin registered');
                    }
                    return true;
                }
                return false;
            }
            
            // Try immediately
            if (!registerPlugins()) {
                // If not ready, wait a bit and try again
                setTimeout(function() {
                    registerPlugins();
                }, 100);
            }
        })();
    </script>

    <!-- Set app version before loading modules (needed for cache detection) -->
    <script>
        window.MINDGRAPH_VERSION = '{{ version }}';
    </script>

    <!-- Admin Panel JavaScript Modules -->
    <script src="/static/js/admin-utils.js?v={{ version }}"></script>
    <script src="/static/js/admin-auth.js?v={{ version }}"></script>
    <script src="/static/js/admin-dashboard.js?v={{ version }}"></script>
    <script src="/static/js/admin-tokens.js?v={{ version }}"></script>
    <script src="/static/js/admin-schools.js?v={{ version }}"></script>
    <script src="/static/js/admin-users.js?v={{ version }}"></script>
    <script src="/static/js/admin-apikeys.js?v={{ version }}"></script>
    <script src="/static/js/admin-announcement.js?v={{ version }}"></script>
    <script src="/static/js/admin-realtime.js?v={{ version }}"></script>

    <!-- Initialize admin panel -->
    <script>
        // Initialize after DOM and modules loaded
        document.addEventListener('DOMContentLoaded', function() {
            checkAdminAuth().then(() => {
                initLanguage();
                loadDashboard();
            });
        });
    </script>
</body>
</html>
