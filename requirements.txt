# MindGraph - AI-Powered Diagram Generation Platform
# Version: 4.28.36 (see VERSION file for current version)
# Python 3.8+ Required (3.13+ Recommended for Best Async Performance)
#
# INSTALLATION INSTRUCTIONS:
#   1. pip install -r requirements.txt
#   2. playwright install chromium  # Install Playwright browser binaries
#   3. Copy .env.example to .env and configure settings
#
# PRODUCTION DEPLOYMENT NOTES:
#   - Review and configure all environment variables in .env
#   - Set feature flags (FEATURE_MINDMATE, FEATURE_VOICE_AGENT, etc.)
#   - Configure database URL for your environment
#   - Set DEBUG=False for production
#   - Optional: Configure Sentry DSN for error tracking
#
# LAST UPDATED: 2026-01-20 - Updated to latest versions

# ============================================================================
# WEB FRAMEWORK
# ============================================================================
fastapi>=0.128.0
uvicorn[standard]>=0.40.0
jinja2>=3.1.6
# Note: Starlette is managed by FastAPI - do not pin explicitly
pydantic>=2.12.5
pydantic-settings>=2.12.0
email-validator>=2.3.0  # Pydantic email validation
orjson>=3.11.5  # Fast JSON serialization for API responses

# ============================================================================
# HTTP & NETWORKING
# ============================================================================
aiohttp>=3.13.3  # Used by Dify client (MindMate integration)
openai>=2.15.0
python-multipart>=0.0.21
httpx[http2]>=0.28.1  # Primary async HTTP client with HTTP/2 (LLM clients, SMS)
websockets>=16.0  # WebSocket support (Omni realtime voice)

# ============================================================================
# AI & LANGUAGE PROCESSING
# ============================================================================
# LangChain 1.x - Major upgrade with create_agent, LangGraph runtime, and middleware
langchain>=1.2.6
langchain-community>=0.4.1
langchain-core>=1.2.7
langchain-openai>=1.1.7  # Updated to latest version
langchain-text-splitters>=1.1.0  # Text chunking for RAG (Personal Knowledge Space)
langgraph>=1.0.6
langgraph-checkpoint>=4.0.0
dashscope>=1.25.8

# ============================================================================
# CONFIGURATION & ENVIRONMENT
# ============================================================================
PyYAML>=6.0.3
python-dotenv>=1.2.1

# ============================================================================
# ASYNC SUPPORT
# ============================================================================
nest_asyncio>=1.6.0
aiofiles>=25.1.0

# ============================================================================
# BROWSER AUTOMATION & IMAGE PROCESSING
# ============================================================================
playwright>=1.57.0
Pillow>=12.1.0  # Image processing (also used for OCR in Personal Knowledge Space)
PyMuPDF>=1.24.0  # PDF rendering for library cover extraction (fitz module)
qrcode[pil]>=8.2  # QR code generation (requires Pillow)

# ============================================================================
# SYSTEM MONITORING & UTILITIES
# ============================================================================
psutil>=7.2.1  # System resource monitoring
watchfiles>=1.1.1  # File watching for auto-reload
rich>=14.2.0  # Rich terminal output with progress bars (for migration progress)

# ============================================================================
# DATABASE & AUTHENTICATION
# ============================================================================
SQLAlchemy>=2.0.45
alembic>=1.18.1  # Database migrations
psycopg2-binary>=2.9.11  # PostgreSQL driver (binary version, no compilation needed, latest version)
python-jose[cryptography]>=3.3.0
bcrypt>=5.0.0  # Password hashing (direct bcrypt, passlib removed in v4.12.0)
captcha>=0.6
pycryptodome>=3.23.0  # AES decryption for bayi mode
# Note: Tencent SMS uses native async httpx calls (no SDK needed)

# ============================================================================
# PERSONAL KNOWLEDGE SPACE (RAG) DEPENDENCIES - REQUIRED
# ============================================================================
numpy>=1.24.0  # Numerical operations for embedding normalization and validation
qdrant-client>=1.16.2  # Vector database for document embeddings (REQUIRED - Qdrant server must be running)
jieba3>=1.0.2  # Chinese text segmentation for FTS5 full-text search (modern Python 3 rewrite, no pkg_resources)
langdetect>=1.0.9  # Language detection for documents
semchunk>=3.2.3  # Semantic text chunking (fast, token-aware, Chinese support)
tiktoken>=0.12.0  # OpenAI tokenizer for semchunk (accurate token counting)
spacy>=3.8.11  # NLP library for sentence-based chunking (offline, requires: python -m spacy download en_core_web_sm)
chonkie>=1.5.2  # Modern chunking library with multiple strategies (offline, base features)
datasets>=4.5.0  # Hugging Face datasets library for benchmark dataset loading
PyPDF2>=3.0.1  # PDF text extraction (alternative: pdfplumber>=0.11.0)
python-docx>=1.2.0  # DOCX text extraction
python-pptx>=1.0.2  # PPTX text extraction
openpyxl>=3.1.5  # XLSX text extraction
beautifulsoup4>=4.14.3  # HTML text extraction
pdfplumber>=0.11.9  # PDF text extraction with page info (fallback for PyPDF2)
pytesseract>=0.3.13  # OCR for image text extraction (requires Tesseract binary)
celery>=5.6.2  # Background task processing for document uploads (REQUIRED - application will exit if not available)
# Note: Tesseract OCR binary must be installed separately:
#   - Windows: Download from https://github.com/UB-Mannheim/tesseract/wiki
#   - macOS: brew install tesseract
#   - Linux: apt-get install tesseract-ocr tesseract-ocr-chi-sim (for Chinese support)
# Note: Qdrant server is REQUIRED. Install with: bash scripts/install_qdrant.sh
#       Then set QDRANT_HOST=localhost:6333 in .env
# Note: Celery is REQUIRED and requires Redis as broker (already included above).
#       Application will exit if Celery cannot start or Qdrant is not available.

# ============================================================================
# CACHING (Redis - REQUIRED)
# ============================================================================
redis>=7.1.0  # Redis client for caching (captcha, rate limiting, sessions)
# Note: Updated to latest version for Redis 8.4 compatibility.
# Requires Python 3.10+ (compatible with Python 3.13+ recommended version).
# For optimized performance: pip install "redis[hiredis]"

# ============================================================================
# IP GEOLOCATION (Local Database - No External APIs)
# ============================================================================
py-ip2region>=3.0.2  # Local IP geolocation database (xdb format, loads into memory)
# Note: Database files (ip2region_v4.xdb and ip2region_v6.xdb) need to be placed in data/ directory
# Download from: https://github.com/lionsoul2014/ip2region

# ============================================================================
# CLOUD STORAGE (Optional)
# ============================================================================
cos-python-sdk-v5>=1.9.41  # Tencent Cloud Object Storage (COS) SDK for online backups

# ============================================================================
# PRODUCTION DEPLOYMENT (Optional but Recommended)
# ============================================================================
# gunicorn>=24.0.0  # WSGI server (not needed - uvicorn is async)
# python-json-logger>=3.2.1  # Structured JSON logging
# sentry-sdk[fastapi]>=2.20.0  # Error tracking - configure SENTRY_DSN in .env
# prometheus-fastapi-instrumentator>=7.0.0  # Prometheus metrics

# ============================================================================
# TESTING (Development/CI)
# ============================================================================
pytest>=9.0.2
pytest-asyncio>=1.3.0
pytest-cov>=7.0.0  # Code coverage
